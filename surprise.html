<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Complete Surprise for SANA — Dots & Themes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root {
            /* Default Theme (Phase -1 / idle) */
            --bg1: #6a11cb;
            --bg2: #2575fc;
            --bg3: #ff6b6b;
            --bg4: #feca57;
            --bg5: #48dbfb;
            --bg6: #1dd1a1;

            --box: #e74c3c;
            --lid: #c0392b;
            --ribbon: #f1c40f;

            --text-glow: rgba(0, 0, 0, 0.7);
            --white: #ffffff;
        }

        /* THEMES */
        /* Phase 0 – Night Glow */
        .theme-glow {
            --bg1: #0f2027;
            --bg2: #203a43;
            --bg3: #2c5364;
            --bg4: #1b2845;
            --bg5: #3a6073;
            --bg6: #16222a;
            --box: #34495e;
            --lid: #2c3e50;
            --ribbon: #8e44ad;
        }

        /* Phase 1 – Cinematic Sunset */
        .theme-sunset {
            --bg1: #ff4e50;
            --bg2: #f9d423;
            --bg3: #fc913a;
            --bg4: #fcb045;
            --bg5: #fd1d1d;
            --bg6: #833ab4;
            --box: #e67e22;
            --lid: #d35400;
            --ribbon: #f1c40f;
        }

        /* Phase 2 – Candy Dream */
        .theme-candy {
            --bg1: #ff9a9e;
            --bg2: #fad0c4;
            --bg3: #ffd1ff;
            --bg4: #fbc2eb;
            --bg5: #a18cd1;
            --bg6: #f7b1d0;
            --box: #ff6b6b;
            --lid: #ff7675;
            --ribbon: #ffeaa7;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            background: linear-gradient(45deg, var(--bg1), var(--bg2), var(--bg3), var(--bg4), var(--bg5), var(--bg6));
            background-size: 1000% 1000%;
            animation: gradientBG 14s ease-in-out infinite;
            font-family: 'Arial', sans-serif;
            transition: background 1s ease;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .gift-box {
            width: 200px; height: 200px; position: absolute; cursor: pointer; z-index: 10; transition: all 1s ease; bottom: 50%; transform: translateY(50%);
        }
        .gift-box.hidden { bottom: -300px; opacity: 0; pointer-events: none; }

        .box { width: 100%; height: 70%; background: var(--box); border-radius: 10px; position: absolute; bottom: 0; box-shadow: 0 5px 15px rgba(0,0,0,.3); }
        .lid { width: 110%; height: 30%; background: var(--lid); border-radius: 10px; position: absolute; top: 0; left: -5%; box-shadow: 0 5px 15px rgba(0,0,0,.3); transform-origin: center bottom; transition: transform 1s ease; }
        .ribbon { position: absolute; background: var(--ribbon); }
        .ribbon-vertical { width: 20px; height: 100%; left: 50%; transform: translateX(-50%); }
        .ribbon-horizontal { width: 100%; height: 20px; top: 50%; transform: translateY(-50%); }
        .box-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); color: white; font-weight: bold; font-size: 1.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,.5); text-align: center; width: 100%; }

        /* Moon */
        .moon-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); opacity: 0; transition: opacity 1.5s ease; z-index: 5; }
        .moon {
            width: 200px; height: 200px; border-radius: 50%; position: relative; cursor: pointer;
            background: radial-gradient(circle at 35% 35%, #fff 5%, #eee 20%, #cfcfd4 40%, #a8a8b3 65%, rgba(0,0,0,.15) 100%);
            box-shadow: 0 0 40px rgba(255,255,255,.8), inset -10px -10px 20px rgba(0,0,0,.2);
            animation: rotateMoon 20s linear infinite;
        }
        @keyframes rotateMoon { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .text-container { position: absolute; width: 100%; height: 100%; pointer-events: none; z-index: 6; }
        .text-item { position: absolute; color: white; font-size: 1.8rem; font-weight: bold; text-shadow: 2px 2px 8px var(--text-glow); opacity: 0; animation: textPulse 2s ease-in-out infinite; transition: all 1.5s ease; transform: translate(-50%, -50%); }
        @keyframes textPulse { 0%,100%{ transform: translate(-50%,-50%) scale(1);} 50%{ transform: translate(-50%,-50%) scale(1.12);} }
        .moon-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); color: white; font-size: 1.2rem; font-weight: bold; text-shadow: 2px 2px 8px var(--text-glow); opacity: 0; transition: opacity 1s ease; text-align: center; width: 80%; pointer-events: none; }
        .moon-text.visible { opacity: 1; }

        /* Video */
        .video-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); width: 80%; max-width: 800px; opacity: 0; transition: opacity 1s ease; z-index: 15; pointer-events: none; }
        .video-container.visible { opacity: 1; pointer-events: all; }
        #videoPlayer { width: 100%; border-radius: 15px; box-shadow: 0 0 30px rgba(0,0,0,.5); }
        .video-close { position: absolute; top: -40px; right: 0; background: #e74c3c; color: white; border: none; border-radius: 50px; padding: 10px 20px; font-size: 1.2rem; font-weight: bold; cursor: pointer; opacity: 0; transition: opacity .5s ease; }
        .video-container.visible .video-close { opacity: 1; }

        /* Name */
        .name-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); opacity: 0; transition: opacity 1.5s ease; z-index: 20; text-align: center; width: 100%; }
        .name-text { display: flex; justify-content: center; flex-wrap: nowrap; max-width: 90%; margin: 0 auto; }
        .name-letter { display: inline-block; font-size: 5rem; font-weight: bold; color: transparent; background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #1dd1a1); -webkit-background-clip: text; background-clip: text; text-shadow: 0 0 10px rgba(255,255,255,.5); margin: 0 5px; opacity: 0; transform: translateY(50px) scale(.5); transition: all .5s ease; }
        .name-space { display: inline-block; width: 20px; }

        .prompt-container { position: absolute; bottom: 150px; text-align: center; opacity: 0; transition: opacity 1s ease; z-index: 25; width: 100%; }
        .prompt-text { color: white; font-size: 1.8rem; margin-bottom: 20px; text-shadow: 2px 2px 8px var(--text-glow); }
        .prompt-buttons { display: flex; justify-content: center; gap: 20px; }
        .prompt-button { padding: 12px 30px; font-size: 1.2rem; font-weight: bold; border: none; border-radius: 50px; cursor: pointer; transition: all .3s ease; box-shadow: 0 4px 10px rgba(0,0,0,.2); }
        .yes-button { background: linear-gradient(45deg, #1dd1a1, #00d2d3); color: white; }
        .no-button { background: linear-gradient(45deg, #ff6b6b, #ee5253); color: white; }
        .prompt-button:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,.3); }

        .firework { position: absolute; width: 5px; height: 5px; border-radius: 50%; pointer-events: none; opacity: 0; }
        .heart { position: absolute; pointer-events: none; opacity: 0; font-size: 2rem; color: #ff6b6b; text-shadow: 0 0 10px rgba(255,105,180,.8); }
        .sparkle { position: absolute; width: 8px; height: 8px; background: white; border-radius: 50%; pointer-events: none; opacity: 0; box-shadow: 0 0 10px 2px rgba(255,255,255,.8); }

        .message { position: absolute; top: 60%; width: 80%; max-width: 600px; text-align: center; color: white; font-size: 1.5rem; text-shadow: 2px 2px 8px var(--text-glow); opacity: 0; transform: translateY(20px); transition: all 1s ease; z-index: 30; }

        /* NEW: Floating DOTS instead of emoji icons */
        .floating-dot {
            position: absolute;
            bottom: -50px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            border: 2px dotted rgba(255,255,255,.6);
            box-shadow: 0 0 6px currentColor, 0 0 12px rgba(255,255,255,.35) inset;
            filter: saturate(1.2);
            animation: floatUp 9s linear forwards, dotDrift 6s ease-in-out infinite;
            z-index: 1;
            opacity: 0;
        }
        @keyframes floatUp { 0%{ transform: translateY(0) rotate(0deg); opacity: 0;} 10%{opacity: 1;} 90%{opacity: 1;} 100%{ transform: translateY(-110vh) rotate(360deg); opacity: 0;} }
        @keyframes dotDrift { 0%,100%{ transform: translateX(0) } 50%{ transform: translateX(40px) } }

        .question-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); color: white; font-size: 2.5rem; font-weight: bold; text-shadow: 2px 2px 8px var(--text-glow); opacity: 0; transition: opacity 1s ease; text-align: center; width: 80%; z-index: 20; }
        .question-text.visible { opacity: 1; }

        .navigation { position: absolute; bottom: 20px; display: flex; gap: 20px; z-index: 10; }
        .nav-button { padding: 12px 24px; background: #3498db; color: white; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,.2); transition: all .3s ease; }
        .nav-button:hover { background: #2980b9; transform: translateY(-3px); }

        .flash-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: white; opacity: 0; pointer-events: none; z-index: 50; }

        .confetti { position: absolute; width: 10px; height: 5px; pointer-events: none; animation: confettiBlink 0.9s linear infinite; }
        @keyframes confettiBlink { 0%,100%{ opacity: .95 } 50%{ opacity: .4 } }

        /* Responsive tweaks */
        @media (max-width: 768px){ .name-letter{ font-size: 3.5rem; margin: 0 2px;} .prompt-text{ font-size: 1.5rem;} .message{ font-size: 1.2rem;} .moon{ width:150px; height:150px;} .text-item{ font-size: 1.4rem;} .question-text{ font-size: 2rem;} .gift-box{ width:150px; height:150px;} .box-text{ font-size:1.2rem;} .prompt-container{ bottom:100px;} .navigation{ flex-direction: column; gap:10px;} }
        @media (max-width: 480px){ .name-letter{ font-size: 2rem; margin: 0 1px;} .name-space{ width: 10px;} .prompt-text{ font-size:1.2rem;} .prompt-button{ padding:10px 20px; font-size:1rem;} .message{ font-size:1rem;} .nav-button{ padding:10px 20px; font-size:1rem;} .moon{ width:120px; height:120px;} .text-item{ font-size: 1.2rem;} .question-text{ font-size:1.5rem;} .gift-box{ width:120px; height:120px;} .box-text{ font-size:1rem;} .prompt-container{ bottom:80px;} .video-close{ top:-30px; padding:8px 16px; font-size:1rem;} }
    </style>
</head>
<body>
    <div class="container">
        <div class="gift-box" id="giftBox">
            <div class="box">
                <div class="ribbon ribbon-vertical"></div>
                <div class="ribbon ribbon-horizontal"></div>
                <div class="box-text">Click Me!</div>
            </div>
            <div class="lid"></div>
        </div>

        <div class="question-text" id="questionText">What you are to me?</div>

        <div class="moon-container" id="moonContainer">
            <div class="moon" id="moon"></div>
            <div class="moon-text" id="moonText">Click to Close</div>
        </div>

        <div class="text-container" id="textContainer"></div>

        <div class="video-container" id="videoContainer">
            <video id="videoPlayer" controls>
                <source src="video.mp4" type="video/mp4" />
                Your browser does not support the video tag.
            </video>
            <button class="video-close" id="videoClose">Close Video</button>
        </div>

        <div class="name-container" id="nameContainer">
            <div class="name-text">
                <span class="name-letter" id="letterS">S</span>
                <span class="name-letter" id="letterA">A</span>
                <span class="name-letter" id="letterN">N</span>
                <span class="name-letter" id="letterA2">A</span>
                <span class="name-space" id="nameSpace"></span>
                <span class="name-letter" id="letterA3">A</span>
                <span class="name-letter" id="letterS2">S</span>
                <span class="name-letter" id="letterI">I</span>
                <span class="name-letter" id="letterF">F</span>
            </div>
        </div>

        <div class="prompt-container" id="promptContainer">
            <div class="prompt-text">Do you want to complete your name?</div>
            <div class="prompt-buttons">
                <button class="prompt-button yes-button" id="yesButton">Yes</button>
                <button class="prompt-button no-button" id="noButton">No</button>
            </div>
        </div>

        <div class="message" id="message">Your name is as beautiful as you are! ❤️</div>

        <div class="navigation">
            <button class="nav-button" onclick="window.location.href='birthday.html'">Previous</button>
            <button class="nav-button" onclick="window.location.href='more-suprise.html'">Next</button>
        </div>
    </div>

    <div class="flash-overlay" id="flashOverlay"></div>

    <audio id="backgroundMusic" loop>
        <source src="surprise.mp3" type="audio/mpeg" />
    </audio>
    <audio id="nameMusic">
        <source src="name.mp3" type="audio/mpeg" />
    </audio>

    <script>
        document.addEventListener('DOMContentLoaded', function(){
            const giftBox = document.getElementById('giftBox');
            const lid = document.querySelector('.lid');
            const boxText = document.querySelector('.box-text');
            const moonContainer = document.getElementById('moonContainer');
            const textContainer = document.getElementById('textContainer');
            const moonText = document.getElementById('moonText');
            const questionText = document.getElementById('questionText');
            const moon = document.getElementById('moon');
            const videoContainer = document.getElementById('videoContainer');
            const videoPlayer = document.getElementById('videoPlayer');
            const videoClose = document.getElementById('videoClose');
            const nameContainer = document.getElementById('nameContainer');
            const promptContainer = document.getElementById('promptContainer');
            const yesButton = document.getElementById('yesButton');
            const noButton = document.getElementById('noButton');
            const message = document.getElementById('message');
            const backgroundMusic = document.getElementById('backgroundMusic');
            const nameMusic = document.getElementById('nameMusic');
            const letters = document.querySelectorAll('.name-letter');
            const nameSpace = document.getElementById('nameSpace');
            const flashOverlay = document.getElementById('flashOverlay');

            // THEME helper
            function setTheme(themeClass){
                document.body.classList.remove('theme-glow','theme-sunset','theme-candy');
                if(themeClass) document.body.classList.add(themeClass);
            }

            // Texts for moon animation
            const texts = [ 'Dream','My world','SunShine',' Glow','Everything','Heart','Universe','Wonder','Home','Moon' ];

            // Initially hide the last name letters and space
            const lastNameLetters = Array.from(letters).slice(4);
            lastNameLetters.forEach(l => { l.style.display = 'none';});
            nameSpace.style.display = 'none';

            let currentPhase = 0;
            let floatInterval;

            // Try to autoplay music with user gesture
            document.body.addEventListener('click', function(){
                backgroundMusic.play().catch(()=>{});
            }, { once: true });

            // Create DOT (replaces emoji icons)
            function createFloatingDot(){
                const dot = document.createElement('div');
                dot.className = 'floating-dot';
                dot.style.left = Math.random()*100 + 'vw';
                dot.style.animationDelay = (Math.random()*3) + 's';
                dot.style.animationDuration = (6 + Math.random()*8) + 's';

                const colors = ['#ff6b6b','#48dbfb','#feca57','#1dd1a1','#ff9ff3','#f368e0','#a29bfe','#55efc4','#ffeaa7'];
                dot.style.color = colors[Math.floor(Math.random()*colors.length)];

                // random size
                const size = 6 + Math.random()*10;
                dot.style.width = size + 'px';
                dot.style.height = size + 'px';

                document.body.appendChild(dot);
                setTimeout(()=>{ dot.remove(); }, 16000);
            }

            // Create circle texts around moon
            function createTextElements(){
                textContainer.innerHTML = '';
                const screenWidth = window.innerWidth;
                const radius = screenWidth < 480 ? 100 : (screenWidth < 768 ? 120 : 180);
                texts.forEach((text, index)=>{
                    const el = document.createElement('div');
                    el.className = 'text-item';
                    el.textContent = text;
                    el.dataset.index = index;
                    const angle = (index / texts.length) * Math.PI * 2;
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;
                    el.style.left = `calc(50% + ${x}px)`;
                    el.style.top = `calc(50% + ${y}px)`;
                    el.style.animationDelay = `${index*0.2}s`;
                    el.style.color = getRandomColor();
                    el.style.opacity = '0';
                    textContainer.appendChild(el);
                    setTimeout(()=>{ el.style.opacity='1'; el.style.transition='opacity 1s ease'; }, index*300);
                });
            }

            function getRandomColor(){
                const colors = ['#ff6b6b','#48dbfb','#a8ff78','#ffd966','#ff8c00','#ff1493','#00bfff','#9b59b6'];
                return colors[Math.floor(Math.random()*colors.length)];
            }

            // Fireworks / hearts / sparkles (unchanged visuals)
            function createFirework(x,y,color){
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = x + 'px';
                firework.style.top = y + 'px';
                firework.style.background = color;
                document.body.appendChild(firework);
                const size = 10 + Math.random()*15;
                const particles = 12 + Math.random()*10;
                for(let i=0;i<particles;i++){
                    const p = document.createElement('div');
                    p.className = 'firework'; p.style.left = x + 'px'; p.style.top = y + 'px'; p.style.background = color; document.body.appendChild(p);
                    const moveX = (Math.random()-0.5)*300; const moveY = (Math.random()-0.5)*300;
                    anime({ targets: p, width:[5,size], height:[5,size], translateX: moveX, translateY: moveY, opacity:[1,0], duration:1000+Math.random()*1000, easing:'easeOutExpo', complete(){ p.remove(); }});
                }
                anime({ targets: firework, width:[5, size*2], height:[5, size*2], opacity:[1,0], duration:800, easing:'easeOutExpo', complete(){ firework.remove(); }});
            }
            function createHeart(x,y){
                const heart = document.createElement('div');
                heart.className='heart';
                heart.innerHTML='❤';
                heart.style.left=x+'px';
                heart.style.top=y+'px';
                document.body.appendChild(heart);
                anime({ targets: heart, translateY:-100, translateX: anime.random(-50,50), opacity:[1,0], scale:[.5,1.5], duration:2000+Math.random()*1000, easing:'easeOutExpo', complete(){ heart.remove(); }});
            }
            function createSparkle(x,y){
                const s = document.createElement('div');
                s.className='sparkle'; s.style.left=x+'px'; s.style.top=y+'px'; document.body.appendChild(s);
                anime({ targets: s, translateY: anime.random(-100,100), translateX: anime.random(-100,100), opacity:[1,0], scale:[.5,2], duration:1000+Math.random()*1000, easing:'easeOutExpo', complete(){ s.remove(); }});
            }

            // Confetti with blink
            function createConfetti(){
                const num = window.innerWidth < 768 ? 50 : 100;
                for(let i=0;i<num;i++){
                    const c = document.createElement('div');
                    c.className = 'confetti';
                    c.style.position='absolute';
                    c.style.width = (Math.random()*10+5)+'px';
                    c.style.height = (Math.random()*3+1)+'px';
                    c.style.background = getRandomColor();
                    c.style.left = Math.random()*window.innerWidth + 'px';
                    c.style.top = '-10px';
                    c.style.opacity = 1;
                    c.style.transform = `rotate(${Math.floor(Math.random()*360)}deg)`;
                    document.body.appendChild(c);
                    anime({ targets: c, translateY: window.innerHeight + 100, translateX: anime.random(-200,200), rotate: anime.random(-720,720), duration: anime.random(3000,6000), easing: 'linear', complete(){ c.remove(); }});
                }
            }

            function blinkScreen(){
                anime({ targets: flashOverlay, keyframes:[{opacity:.7},{opacity:0},{opacity:.7},{opacity:0},{opacity:.7},{opacity:0}], duration: 2200, easing: 'easeInOutQuad' });
            }

            function animateName(){
                nameMusic.play();
                nameContainer.style.opacity = '1';
                const colors = ['#ff6b6b','#48dbfb','#1dd1a1','#feca57'];
                const first = Array.from(letters).slice(0,4);
                first.forEach((letter, i)=>{
                    setTimeout(()=>{
                        const rect = letter.getBoundingClientRect();
                        const x = rect.left + rect.width/2; const y = rect.top + rect.height/2;
                        for(let k=0;k<22;k++) setTimeout(()=>{ createFirework(x,y,colors[i]); }, k*30);
                        for(let k=0;k<8;k++) setTimeout(()=>{ createHeart(x+anime.random(-50,50), y+anime.random(-50,50)); createSparkle(x+anime.random(-50,50), y+anime.random(-50,50)); }, k*160);
                        anime({ targets: letter, opacity:1, translateY:0, scale:1, duration:800, easing:'easeOutElastic(1,.5)' });
                    }, i*700);
                });
                setTimeout(()=>{ promptContainer.style.opacity='1'; }, 3200);
            }

            function showFullName(){
                createConfetti();
                blinkScreen();
                promptContainer.style.opacity = '0';
                nameSpace.style.display='inline-block';
                lastNameLetters.forEach(l=>{ l.style.display='inline-block'; });
                setTimeout(()=>{
                    const lastColors = ['#ff9ff3','#f368e0','#ff6b6b','#48dbfb'];
                    lastNameLetters.forEach((letter, i)=>{
                        setTimeout(()=>{
                            const rect = letter.getBoundingClientRect();
                            const x = rect.left + rect.width/2; const y = rect.top + rect.height/2;
                            for(let k=0;k<28;k++) setTimeout(()=>{ createFirework(x,y,lastColors[i]); }, k*28);
                            for(let k=0;k<10;k++) setTimeout(()=>{ createHeart(x+anime.random(-50,50), y+anime.random(-50,50)); createSparkle(x+anime.random(-50,50), y+anime.random(-50,50)); }, k*150);
                            anime({ targets: letter, opacity:1, translateY:0, scale:1, duration:800, easing:'easeOutElastic(1,.5)'});
                        }, i*700);
                    });
                    setTimeout(()=>{ anime({ targets: message, opacity:1, translateY:0, duration:1000, easing:'easeOutExpo' }); }, 3600);
                }, 400);
            }

            function resetAnimation(){
                setTheme(); // back to default
                nameContainer.style.opacity = '0';
                promptContainer.style.opacity = '0';
                message.style.opacity = '0';
                moonContainer.style.opacity = '0';
                moonText.classList.remove('visible');
                textContainer.innerHTML = '';
                videoContainer.classList.remove('visible');
                lastNameLetters.forEach(l=>{ l.style.display='none'; l.style.opacity='0'; l.style.transform='translateY(50px) scale(.5)'; });
                nameSpace.style.display='none';
                const first = Array.from(letters).slice(0,4);
                first.forEach(l=>{ l.style.opacity='0'; l.style.transform='translateY(50px) scale(.5)'; });
                boxText.textContent = 'Click Me!';
                currentPhase = 0;
                lid.style.transform = '';
                giftBox.classList.remove('hidden');
                clearInterval(floatInterval);
                document.querySelectorAll('.floating-dot').forEach(d => d.remove());
                backgroundMusic.currentTime = 0; backgroundMusic.play();
                nameMusic.pause(); nameMusic.currentTime = 0;
                videoPlayer.pause(); videoPlayer.currentTime = 0;
            }

            function closeMoonAnimation(){
                document.querySelectorAll('.text-item').forEach(item=>{
                    item.style.transition='all 1.5s ease';
                    item.style.left='50%'; item.style.top='50%'; item.style.transform='translate(-50%,-50%) scale(.1)'; item.style.opacity='0';
                });
                moonText.classList.remove('visible');
                setTimeout(()=>{
                    moonContainer.style.opacity='0';
                    setTimeout(()=>{
                        lid.style.transform=''; giftBox.classList.remove('hidden'); boxText.textContent='Click me again'; clearInterval(floatInterval); currentPhase = 1; backgroundMusic.pause();
                    }, 500);
                }, 1500);
            }

            function closeVideo(){
                videoPlayer.pause();
                videoContainer.classList.remove('visible');
                setTimeout(()=>{
                    lid.style.transform=''; giftBox.classList.remove('hidden'); boxText.textContent='Click me again'; clearInterval(floatInterval); currentPhase = 2;
                }, 500);
            }

            // Events
            giftBox.addEventListener('click', function(){
                lid.style.transform = 'rotateX(-110deg)';
                boxText.textContent = '';

                if(currentPhase === 0){
                    // PHASE 0 — Moon theme
                    setTheme('theme-glow');
                    setTimeout(()=>{ questionText.classList.add('visible'); }, 700);
                    setTimeout(()=>{ questionText.classList.remove('visible'); }, 3800);
                    setTimeout(()=>{
                        giftBox.classList.add('hidden');
                        moonContainer.style.opacity = '1';
                        for(let i=0;i<20;i++) setTimeout(createFloatingDot, i*250);
                        floatInterval = setInterval(createFloatingDot, 900);
                        setTimeout(()=>{ createTextElements(); setTimeout(()=>{ moonText.classList.add('visible'); }, 2200); }, 700);
                    }, 3500);
                } else if (currentPhase === 1){
                    // PHASE 1 — Video theme
                    setTheme('theme-sunset');
                    setTimeout(()=>{
                        giftBox.classList.add('hidden');
                        videoContainer.classList.add('visible');
                        videoPlayer.play();
                        backgroundMusic.pause();
                        for(let i=0;i<20;i++) setTimeout(createFloatingDot, i*250);
                        floatInterval = setInterval(createFloatingDot, 900);
                    }, 700);
                } else if (currentPhase === 2){
                    // PHASE 2 — Name theme
                    setTheme('theme-candy');
                    setTimeout(()=>{
                        giftBox.classList.add('hidden');
                        for(let i=0;i<20;i++) setTimeout(createFloatingDot, i*250);
                        floatInterval = setInterval(createFloatingDot, 900);
                        animateName();
                    }, 700);
                }
            });

            moon.addEventListener('click', closeMoonAnimation);
            videoClose.addEventListener('click', closeVideo);
            videoPlayer.addEventListener('ended', closeVideo);
            yesButton.addEventListener('click', showFullName);
            noButton.addEventListener('click', resetAnimation);
            message.addEventListener('click', resetAnimation);
            window.addEventListener('resize', function(){ if(moonContainer.style.opacity === '1'){ createTextElements(); } });
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
</body>
</html>
